var e=require("nodecg-io-core").requireService;var a=function(e,a){const n=e.Replicant("databaseReady");n.value=!1,e.log.info("Setting up Bug Data service."),e.listenFor("ChatReceived","twitch-listener",(({user:n,message:i})=>{if(!n||!i||!i.startsWith("!bug "))return;const t=i.split(" ").slice(1).join(" ").toLowerCase(),o=e.Replicant("acGameVersion");let l=null;if(e.log.info("looking up bug data for",o.value),"doubutsu-no-mori-e+"===o.value)l="dnmeplus_bug_data";else l="ac_bug_data";l&&(e.log.info("using tablename",l),a(l).first("name","available","peak","time","location","spawn","rain").where("name",t).then((a=>{a?function(e,a){if(a&&a){let n=`${a.name}: available ${a.location} ${a.available}, ${a.time}.`;a.available!==a.peak&&(n+=` peaks in ${a.peak}.`),n+=` ${a.spawn} spawn rate (in this route)`,a.rain?n+=".":n+=" but not in rain.",e.sendMessageToBundle("SendChatMessage","twitch-listener",n)}}(e,a):e.log.info("no bug found,",t)})).catch((a=>{e.log.error(a)})))})),e.log.info("Done setting up Bug Data service."),n.value=!0};module.exports=function(n){n.log.info("Animal Crossing Bug Data bundle started."),n.Replicant("databaseReady",{defaultValue:!1}),n.Replicant("acGameVersion",{defaultValue:"none"});const i=e(n,"sql");i.onAvailable((async e=>{a(n,e)})),i.onUnavailable((async()=>function(e){e.log.info("Tearing down Animal Crossing Bug Data service."),e.Replicant("databaseReady").value=!1,e.log.info("Done tearing down Animal Crossing Bug Data service.")}(n)))};
//# sourceMappingURL=index.js.map
