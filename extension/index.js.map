{"mappings":"gCAAMA,eA2ENC,OAAAC,QAAiB,SAAUC,GAC1BA,EAAOC,IAAIC,KAAK,4CAChBF,EAAOG,UAAU,gBAAiB,CACjCC,cAAc,IAEfJ,EAAOG,UAAU,gBAAiB,CACjCC,aAAc,SAGf,MAAMC,EAAQC,EAAeN,EAAQ,OAErCK,EAAME,aAAYC,MAAMC,KA9DzB,SAAsBT,EAAQS,GAC7B,MAAMC,EAAeV,EAAOG,UAAU,iBAEtCO,EAAaC,OAAQ,EAErBX,EAAOC,IAAIC,KAAK,gCAEhBF,EAAOY,UAAU,eAAgB,mBAAmB,EAACC,KAACA,EAAIC,QAAEA,MAC3D,IAAKD,IAASC,IAAYA,EAAQC,WAAW,SAC5C,OAGD,MAAMC,EAAUF,EAAQG,MAAM,KAAKC,MAAM,GAAGC,KAAK,KAAKC,cAChDC,EAAcrB,EAAOG,UAAU,iBACrCH,EAAOC,IAAIC,KAAK,0BAA2BmB,EAAYV,OAC/CU,EAAYV,MAGlBF,EAAU,eACRa,MACA,OACA,YACA,OACA,OACA,WACA,QACA,QAEAC,MAAM,OAAQP,GACdQ,MAAKC,IACDA,EApDV,SAAqBzB,EAAQ0B,GAC5B,GAAKA,GAIDA,EAAK,CACR,IAAIC,EAAS,GAAGD,EAAIE,mBAAmBF,EAAIG,YAAYH,EAAII,cAAcJ,EAAIK,QACzEL,EAAII,YAAcJ,EAAIM,OACzBL,GAAU,aAAaD,EAAIM,SAG5BL,GAAU,IAAID,EAAIO,mCACdP,EAAIQ,KACPP,GAAU,IAEVA,GAAU,oBAGX3B,EAAOmC,oBAAoB,kBAAmB,kBAAmBR,IAmC5DS,CAAYpC,EAAQyB,GAEpBzB,EAAOC,IAAIC,KAAK,gBAAiBc,SAOvChB,EAAOC,IAAIC,KAAK,qCAChBQ,EAAaC,OAAQ,EAsBpB0B,CAAarC,EAAQS,MAGtBJ,EAAMiC,eAAc9B,SAtBrB,SAAyBR,GACxBA,EAAOC,IAAIC,KAAK,kDACKF,EAAOG,UAAU,iBACzBQ,OAAQ,EACrBX,EAAOC,IAAIC,KAAK,uDAkBgBqC,CAAgBvC","sources":["src/extension/index.js"],"sourcesContent":["const {requireService} = require('nodecg-io-core');\n\nfunction bugCallback(nodecg, bug) {\n\tif (!bug) {\n\t\treturn;\n\t}\n\n\tif (bug) {\n\t\tlet outMsg = `${bug.name}: available ${bug.location} ${bug.available}, ${bug.time}.`;\n\t\tif (bug.available !== bug.peak) {\n\t\t\toutMsg += ` peaks in ${bug.peak}.`;\n\t\t}\n\n\t\toutMsg += ` ${bug.spawn} spawn rate (in this route)`;\n\t\tif (bug.rain) {\n\t\t\toutMsg += '.';\n\t\t} else {\n\t\t\toutMsg += ' but not in rain.';\n\t\t}\n\n\t\tnodecg.sendMessageToBundle('SendChatMessage', 'twitch-listener', outMsg);\n\t}\n}\n\nfunction setupBugData(nodecg, sqlClient) {\n\tconst bugDataReady = nodecg.Replicant('databaseReady');\n\n\tbugDataReady.value = false;\n\n\tnodecg.log.info('Setting up Bug Data service.');\n\n\tnodecg.listenFor('ChatReceived', 'twitch-listener', ({user, message}) => {\n\t\tif (!user || !message || !message.startsWith('!bug ')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst bugName = message.split(' ').slice(1).join(' ').toLowerCase();\n\t\tconst gameVersion = nodecg.Replicant('acGameVersion');\n\t\tnodecg.log.info('looking up bug data for', gameVersion.value);\n\t\tswitch (gameVersion.value) {\n\t\t\tcase 'animal-crossing':\n\t\t\tdefault:\n\t\t\t\tsqlClient('ac_bug_data')\n\t\t\t\t\t.first(\n\t\t\t\t\t\t'name',\n\t\t\t\t\t\t'available',\n\t\t\t\t\t\t'peak',\n\t\t\t\t\t\t'time',\n\t\t\t\t\t\t'location',\n\t\t\t\t\t\t'spawn',\n\t\t\t\t\t\t'rain'\n\t\t\t\t\t)\n\t\t\t\t\t.where('name', bugName)\n\t\t\t\t\t.then(row => {\n\t\t\t\t\t\tif (row) {\n\t\t\t\t\t\t\tbugCallback(nodecg, row);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnodecg.log.info('no bug found,', bugName);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t});\n\n\tnodecg.log.info('Done setting up Bug Data service.');\n\tbugDataReady.value = true;\n}\n\nfunction teardownBugData(nodecg) {\n\tnodecg.log.info('Tearing down Animal Crossing Bug Data service.');\n\tconst bugDataReady = nodecg.Replicant('databaseReady');\n\tbugDataReady.value = false;\n\tnodecg.log.info('Done tearing down Animal Crossing Bug Data service.');\n}\n\nmodule.exports = function (nodecg) {\n\tnodecg.log.info('Animal Crossing Bug Data bundle started.');\n\tnodecg.Replicant('databaseReady', {\n\t\tdefaultValue: false\n\t});\n\tnodecg.Replicant('acGameVersion', {\n\t\tdefaultValue: 'none'\n\t});\n\n\tconst bugDb = requireService(nodecg, 'sql');\n\n\tbugDb.onAvailable(async sqlClient => {\n\t\tsetupBugData(nodecg, sqlClient);\n\t});\n\n\tbugDb.onUnavailable(async () => teardownBugData(nodecg));\n};\n"],"names":["requireService","module","exports","nodecg","log","info","Replicant","defaultValue","bugDb","$57621f5187ddf231$require$requireService","onAvailable","async","sqlClient","bugDataReady","value","listenFor","user","message","startsWith","bugName","split","slice","join","toLowerCase","gameVersion","first","where","then","row","bug","outMsg","name","location","available","time","peak","spawn","rain","sendMessageToBundle","$57621f5187ddf231$var$bugCallback","$57621f5187ddf231$var$setupBugData","onUnavailable","$57621f5187ddf231$var$teardownBugData"],"version":3,"file":"index.js.map","sourceRoot":"../"}